<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™®ç“¦æ¾åˆ†é…è¡¨ - StatEcon Tools</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/styles.css">
    <style>
        .poisson-hero {
            text-align: left;
        }
        .poisson-hero h1 {
            margin-bottom: 0.5rem;
        }
        .highlight-list {
            margin-top: 1.75rem;
            display: grid;
            gap: 1rem;
        }
        .highlight-item {
            display: flex;
            gap: 0.85rem;
            align-items: flex-start;
        }
        .highlight-item span {
            display: grid;
            place-items: center;
            width: 36px;
            height: 36px;
            border-radius: 12px;
            background: rgba(56, 189, 248, 0.12);
            color: #bae6fd;
            font-weight: 700;
        }
        .split-layout {
            display: grid;
            gap: 2rem;
        }
        @media (min-width: 960px) {
            .split-layout {
                grid-template-columns: 0.75fr 1fr;
                align-items: center;
            }
        }
        .card-note {
            margin-top: 1.25rem;
            padding: 1rem 1.1rem;
            border-radius: var(--radius-md);
            background: rgba(56, 189, 248, 0.08);
            color: var(--text-secondary);
            border: 1px solid rgba(56, 189, 248, 0.2);
            font-size: 0.95rem;
        }
    </style>
</head>
<body class="app-shell">
    <header class="app-header">
        <div class="header-inner">
            <a class="brand" href="index.html">StatEcon Tools</a>
            <nav class="header-nav">
                <a href="index.html#distribution" class="active">æ©Ÿç‡åˆ†é…å·¥å…·</a>
                <a href="t-distribution.html">t åˆ†é…è¡¨</a>
                <a href="economics.html">å·¥ç¨‹ç¶“æ¿Ÿ</a>
            </nav>
            <div class="header-actions">
                <a class="back-link" href="index.html">â† è¿”å›é¦–é </a>
            </div>
        </div>
    </header>

    <main class="app-main">
        <section class="section poisson-hero">
            <div class="split-layout">
                <div>
                    <span class="hero-label">Poisson Distribution</span>
                    <h1>æ™®ç“¦æ¾åˆ†é…è¡¨èˆ‡è¦–è¦ºåŒ–å·¥å…·</h1>
                    <p>
                        é€éè¼¸å…¥ Î»ï¼ˆå¹³å‡ç™¼ç”Ÿç‡ï¼‰ï¼Œå³æ™‚è¨ˆç®—é›¢æ•£äº‹ä»¶çš„æ©Ÿç‡è³ªé‡å‡½æ•¸èˆ‡ç´¯ç©æ©Ÿç‡ã€‚
                        ä»¥é«˜å°æ¯”è¡¨æ ¼æ­é…äº’å‹•å¼æ¢ç‹€åœ–å‘ˆç¾ï¼Œå”åŠ©ä½ å¿«é€Ÿæ¯”è¼ƒä¸åŒ k å€¼çš„è®ŠåŒ–ã€‚
                    </p>
                    <div class="hero-actions" style="justify-content: flex-start;">
                        <button class="btn btn-primary" id="generateBtn">ç”Ÿæˆåˆ†é…è¡¨</button>
                        <a class="btn btn-outline" href="https://zh.wikipedia.org/wiki/%E6%99%AE%E7%93%A6%E6%9D%BE%E5%88%86%E4%BD%88" target="_blank" rel="noopener">äº†è§£æ™®ç“¦æ¾åˆ†é…</a>
                    </div>
                </div>
                <div>
                    <div class="card" style="margin:0;">
                        <div class="card-header">
                            <div class="card-title">
                                <span class="icon">âœ¨</span>
                                åŠŸèƒ½äº®é»
                            </div>
                        </div>
                        <div class="highlight-list">
                            <div class="highlight-item">
                                <span>1</span>
                                <div>
                                    <strong>è¡¨æ ¼èˆ‡åœ–è¡¨åŒæ­¥</strong>
                                    <p class="helper-text">é»é¸ä»»ä¸€åˆ—å³å¯åœ¨åœ–è¡¨ä¸­åŒæ­¥é«˜äº®ï¼Œåä¹‹äº¦ç„¶ã€‚</p>
                                </div>
                            </div>
                            <div class="highlight-item">
                                <span>2</span>
                                <div>
                                    <strong>åˆ†é é¡¯ç¤º</strong>
                                    <p class="helper-text">ä¾ Î» è‡ªå‹•èª¿æ•´ k çš„ç¯„åœï¼Œä¿æŒå¯è®€æ€§èˆ‡æµæš¢æ“ä½œã€‚</p>
                                </div>
                            </div>
                            <div class="highlight-item">
                                <span>3</span>
                                <div>
                                    <strong>çµ±è¨ˆæ‘˜è¦</strong>
                                    <p class="helper-text">è‡ªå‹•è¨ˆç®—æœŸæœ›å€¼ã€è®Šç•°æ•¸ã€æ¨™æº–å·®èˆ‡ç´¯ç©ç¸½å’Œã€‚</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="section section--compact">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <span class="icon">Î»</span>
                        åƒæ•¸è¨­å®š
                    </div>
                </div>
                <p class="card-subtitle">è¼¸å…¥ Î»ï¼ˆå¿…é ˆç‚ºå¤§æ–¼ 0 çš„æ•¸å€¼ï¼‰ï¼Œå³å¯ç”Ÿæˆå°æ‡‰çš„æ™®ç“¦æ¾åˆ†é…è¡¨ã€‚</p>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="lambdaInput">Î» (Lambda) åƒæ•¸å€¼</label>
                        <div class="input-group">
                            <input type="number" id="lambdaInput" class="input-control" placeholder="ä¾‹å¦‚ï¼š2.5" step="0.1" min="0.1" value="2.5">
                            <button class="btn btn-outline" id="quickGenerate">å¿«é€Ÿæ›´æ–°</button>
                        </div>
                        <p class="helper-text">æŒ‰ä¸‹ Enter æˆ–ã€Œå¿«é€Ÿæ›´æ–°ã€å³å¯é‡æ–°è¨ˆç®—ï¼›è‹¥è¼¸å…¥ç‚ºå°æ•¸å»ºè­°ä¿ç•™ä¸€ä½ä»¥ä¸Šã€‚</p>
                    </div>
                </div>
                <div id="alert" class="alert alert--danger">
                    <span>âš ï¸</span>
                    <span id="alertText">è«‹è¼¸å…¥æœ‰æ•ˆçš„ Î» å€¼</span>
                </div>
                <div class="card-note">
                    å»ºè­°æ­é…èª²æœ¬æˆ–æ•™å­¸è¬›ç¾©ï¼Œä¸€æ¬¡æ¯”è¼ƒä¸åŒ Î» ä¸‹çš„æ©Ÿç‡åˆ†å¸ƒã€‚ä½¿ç”¨éµç›¤ä¸Šä¸‹éµå¾®èª¿ Î»ï¼Œå¯å¿«é€Ÿè§€å¯Ÿè¶¨å‹¢ã€‚
                </div>
            </div>
        </section>

        <section class="section section--compact" id="statsCard" style="display:none;">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <span class="icon">ğŸ“ˆ</span>
                        çµ±è¨ˆæ‘˜è¦
                    </div>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">æœŸæœ›å€¼ E(X)</div>
                        <div id="meanValue" class="stat-value">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">è®Šç•°æ•¸ Var(X)</div>
                        <div id="varianceValue" class="stat-value">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">æ¨™æº–å·® Ïƒ</div>
                        <div id="stdDevValue" class="stat-value">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">ç´¯ç©ç¸½å’Œ</div>
                        <div id="totalProbValue" class="stat-value">-</div>
                    </div>
                </div>
            </div>
        </section>

        <section class="section section--compact" id="dataCard" style="display:none;">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <span class="icon">ğŸ“Š</span>
                        è³‡æ–™è¦–è¦ºåŒ–
                    </div>
                </div>
                <p class="card-subtitle">åˆ‡æ›åˆ†é é¸æ“‡è¡¨æ ¼æˆ–åœ–è¡¨ã€‚é»é¸è³‡æ–™åˆ—æˆ–é•·æ¢å³å¯äº’ç›¸é«˜äº®ä¸¦åŒæ­¥å°æ‡‰é é¢ã€‚</p>
                <div class="tab-nav">
                    <button class="tab-btn active" data-tab="table">è³‡æ–™è¡¨æ ¼</button>
                    <button class="tab-btn" data-tab="chart">åˆ†é…åœ–è¡¨</button>
                </div>
                <div id="table" class="tab-content active">
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>k å€¼</th>
                                    <th>P(X = k)</th>
                                    <th>P(X â‰¤ k)</th>
                                </tr>
                            </thead>
                            <tbody id="tableBody"></tbody>
                        </table>
                    </div>
                    <div class="pagination" id="pagination"></div>
                </div>
                <div id="chart" class="tab-content">
                    <div class="chart-surface">
                        <div class="bar-container" id="barContainer"></div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <div class="loading" id="loading">
        <div class="spinner"></div>
    </div>

    <footer class="footer">
        <div class="section">
            <span>Â© 2024 StatEcon Tools</span>
            <span>æœ€å¾Œæ›´æ–°ï¼šä»¥è¼¸å…¥åƒæ•¸å³æ™‚è¨ˆç®—</span>
        </div>
    </footer>

    <script>
        const ROWS_PER_PAGE = 10;
        let currentPage = 1;
        let poissonData = [];
        let selectedK = null;
        const elements = {
            lambdaInput: document.getElementById('lambdaInput'),
            generateBtn: document.getElementById('generateBtn'),
            quickGenerate: document.getElementById('quickGenerate'),
            alert: document.getElementById('alert'),
            alertText: document.getElementById('alertText'),
            statsCard: document.getElementById('statsCard'),
            dataCard: document.getElementById('dataCard'),
            tableBody: document.getElementById('tableBody'),
            pagination: document.getElementById('pagination'),
            loading: document.getElementById('loading'),
            meanValue: document.getElementById('meanValue'),
            varianceValue: document.getElementById('varianceValue'),
            stdDevValue: document.getElementById('stdDevValue'),
            totalProbValue: document.getElementById('totalProbValue'),
            barContainer: document.getElementById('barContainer')
        };

        const factorialCache = { 0: 1, 1: 1 };

        function factorial(n) {
            if (factorialCache[n] !== undefined) return factorialCache[n];
            factorialCache[n] = n * factorial(n - 1);
            return factorialCache[n];
        }

        function poissonProbability(lambda, k) {
            return (Math.pow(lambda, k) * Math.exp(-lambda)) / factorial(k);
        }

        function generatePoissonData(lambda) {
            const data = [];
            const maxK = Math.max(30, Math.ceil(lambda + 6 * Math.sqrt(lambda)));
            let cumulative = 0;

            for (let k = 0; k <= maxK; k++) {
                const probability = poissonProbability(lambda, k);
                cumulative += probability;

                data.push({
                    k,
                    probability,
                    cumulative,
                    probStr: probability.toFixed(6),
                    cumStr: cumulative.toFixed(6)
                });

                if (cumulative > 0.99999) break;
            }

            return data;
        }

        function updateStatistics(lambda) {
            const total = poissonData.reduce((sum, item) => sum + item.probability, 0);

            elements.meanValue.textContent = lambda.toFixed(4);
            elements.varianceValue.textContent = lambda.toFixed(4);
            elements.stdDevValue.textContent = Math.sqrt(lambda).toFixed(4);
            elements.totalProbValue.textContent = total.toFixed(4);

            elements.statsCard.style.display = 'block';
        }

        function renderTable() {
            const start = (currentPage - 1) * ROWS_PER_PAGE;
            const end = start + ROWS_PER_PAGE;
            const pageData = poissonData.slice(start, end);

            elements.tableBody.innerHTML = '';

            pageData.forEach(item => {
                const row = document.createElement('tr');
                if (item.k === selectedK) {
                    row.classList.add('highlighted');
                }

                row.innerHTML = `
                    <td>${item.k}</td>
                    <td>${item.probStr}</td>
                    <td>${item.cumStr}</td>
                `;

                row.addEventListener('click', () => {
                    selectedK = item.k;
                    renderTable();
                    highlightChartBar(item.k);
                });

                elements.tableBody.appendChild(row);
            });
        }

        function renderPagination() {
            const totalPages = Math.ceil(poissonData.length / ROWS_PER_PAGE);
            elements.pagination.innerHTML = '';

            const prevBtn = document.createElement('button');
            prevBtn.innerHTML = 'â†';
            prevBtn.disabled = currentPage === 1;
            prevBtn.addEventListener('click', () => {
                if (currentPage > 1) {
                    currentPage--;
                    renderTable();
                    renderPagination();
                }
            });
            elements.pagination.appendChild(prevBtn);

            const maxVisible = 5;
            let startPage = Math.max(1, currentPage - 2);
            let endPage = Math.min(totalPages, startPage + maxVisible - 1);

            if (endPage - startPage < maxVisible - 1) {
                startPage = Math.max(1, endPage - maxVisible + 1);
            }

            for (let i = startPage; i <= endPage; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.textContent = i;
                if (i === currentPage) {
                    pageBtn.classList.add('active');
                }
                pageBtn.addEventListener('click', () => {
                    currentPage = i;
                    renderTable();
                    renderPagination();
                });
                elements.pagination.appendChild(pageBtn);
            }

            const nextBtn = document.createElement('button');
            nextBtn.innerHTML = 'â†’';
            nextBtn.disabled = currentPage === totalPages;
            nextBtn.addEventListener('click', () => {
                if (currentPage < totalPages) {
                    currentPage++;
                    renderTable();
                    renderPagination();
                }
            });
            elements.pagination.appendChild(nextBtn);
        }

        function renderChart() {
            elements.barContainer.innerHTML = '';

            const maxProb = Math.max(...poissonData.map(item => item.probability));

            poissonData.forEach(item => {
                const barHeight = (item.probability / maxProb) * 100;

                const bar = document.createElement('div');
                bar.className = 'chart-bar';
                bar.id = `bar-${item.k}`;
                bar.style.height = `${barHeight}%`;

                if (item.k === selectedK) {
                    bar.classList.add('highlighted');
                }

                const tooltip = document.createElement('div');
                tooltip.className = 'bar-tooltip';
                tooltip.innerHTML = `k=${item.k}<br>P=${item.probStr}`;
                bar.appendChild(tooltip);

                bar.addEventListener('click', () => {
                    selectedK = item.k;
                    highlightChartBar(item.k);

                    const index = poissonData.findIndex(d => d.k === item.k);
                    const page = Math.floor(index / ROWS_PER_PAGE) + 1;
                    if (page !== currentPage) {
                        currentPage = page;
                        renderTable();
                        renderPagination();
                    }

                    openTab('table');
                });

                elements.barContainer.appendChild(bar);
            });
        }

        function highlightChartBar(k) {
            document.querySelectorAll('.chart-bar').forEach(bar => {
                bar.classList.remove('highlighted');
            });

            const bar = document.getElementById(`bar-${k}`);
            if (bar) {
                bar.classList.add('highlighted');
            }
        }

        function generateDistribution() {
            const lambda = parseFloat(elements.lambdaInput.value);

            if (isNaN(lambda) || lambda <= 0) {
                showAlert('è«‹è¼¸å…¥æœ‰æ•ˆçš„ Î» å€¼ï¼ˆå¿…é ˆå¤§æ–¼ 0ï¼‰', 'danger');
                return;
            }

            showLoading(true);
            selectedK = null;

            setTimeout(() => {
                poissonData = generatePoissonData(lambda);
                currentPage = 1;

                updateStatistics(lambda);
                renderTable();
                renderPagination();
                renderChart();

                elements.dataCard.style.display = 'block';
                showLoading(false);
                showAlert(`æˆåŠŸç”Ÿæˆ Î» = ${lambda} çš„æ™®ç“¦æ¾åˆ†é…è¡¨`, 'success');
            }, 250);
        }

        function showAlert(message, type = 'danger') {
            elements.alertText.textContent = message;
            elements.alert.className = `alert alert--${type} show`;
            setTimeout(() => {
                elements.alert.classList.remove('show');
            }, 3200);
        }

        function showLoading(show) {
            elements.loading.classList.toggle('show', show);
        }

        function openTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            document.getElementById(tabName).classList.add('active');
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');

            if (tabName === 'chart' && poissonData.length > 0) {
                setTimeout(() => renderChart(), 100);
            }
        }

        function handleGenerate() {
            generateDistribution();
        }

        elements.generateBtn.addEventListener('click', handleGenerate);
        elements.quickGenerate.addEventListener('click', handleGenerate);

        elements.lambdaInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                generateDistribution();
            }
        });

        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                openTab(btn.dataset.tab);
            });
        });

        window.addEventListener('load', () => {
            generateDistribution();
        });

        window.addEventListener('resize', () => {
            if (document.getElementById('chart').classList.contains('active') && poissonData.length > 0) {
                renderChart();
            }
        });
    </script>
</body>
</html>
